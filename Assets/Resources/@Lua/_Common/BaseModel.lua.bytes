local BaseModel = _MOE.class("BaseModel")

function BaseModel:Init()
    xpcall(self.OnInit, _G.ErrorHandler, self)
    xpcall(self.RegisterEvents, _G.ErrorHandler, self)
end

function BaseModel:UnInit()
    xpcall(self.UnRegisterEvents, _G.ErrorHandler, self)
    self:UnRegsterAllCsharpEvents()
    xpcall(self.OnUnInit, _G.ErrorHandler, self)
end

function BaseModel:RegsterCSharpEvent(csharpObj, eventName, func)
    if not csharpObj or not eventName or not func then
        return
    end
    self.CSharpEvents = self.CSharpEvents or {}
    local events = self.CSharpEvents[csharpObj]
    if not events then
        events = {}
        self.CSharpEvents[csharpObj] = events
    end
    if events[eventName] == func then
        return
    end
    events[eventName] = func
    csharpObj[eventName] = function (...)
        func(self, ...)
    end
end

function BaseModel:UnRegsterCSharpEvent(csharpObj, eventName)
    if not csharpObj or not eventName or not self.CSharpEvents then
        return
    end
    local events = self.CSharpEvents[csharpObj]
    if not events then
        return
    end
    if events[eventName] then
        events[eventName] = nil
        if next(events) == nil then
            self.CSharpEvents[csharpObj] = nil
        end
        csharpObj[eventName] = nil
        if next(self.CSharpEvents) == nil then
            self.CSharpEvents = nil
        end
    end
end

function BaseModel:UnRegsterAllCsharpEvents()
    if not self.CSharpEvents then
        return
    end
    for csharpObj, events in pairs(self.CSharpEvents) do
        if csharpObj and events then
            for eventName, _ in pairs(events) do
                csharpObj[eventName] = nil
            end
        end
    end
    self.CSharpEvents = nil
end

-- 登出
function BaseModel:Loginout()
    self:OnLoginout()
end

-- 断线重连成功
function BaseModel:ReConnected()
    self:OnReConnected()
end

------------------------------------------------ 虚方法 ----------------------------------
function BaseModel:OnInit()
end

function BaseModel:OnUnInit()
end

function BaseModel:OnLoginout()
end

function BaseModel:OnReConnected()
end

function BaseModel:RegisterEvents()
end

function BaseModel:UnRegisterEvents()
end

return BaseModel